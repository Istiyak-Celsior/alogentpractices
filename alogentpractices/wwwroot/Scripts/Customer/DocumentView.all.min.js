(function(n,t,i){i.mvvm||(i.mvvm={});i.mvvm.Model=i.data.Model.extend({init:function(){i.data.Model.fn.init.call(this)}});i.mvvm.View=i.Class.extend({init:function(n,i){var r=this;r.viewModel=i;t(document).ready(t.proxy(r._ready,r,t(n),i))},_ready:function(n,r){t("[data-role='pageload']").remove();i.ui.progress(n,!0);this.ready(n,r)},ready:function(n,t){i.bind(n,t);i.ui.progress(n,!1)}});i.mvvm.ViewModel=i.data.ObservableObject.extend({init:function(){i.data.ObservableObject.fn.init.call(this,this)}});i.mvvm.DialogViewModel=i.mvvm.ViewModel.extend({init:function(){ViewModel.fn.init.call(this)},triggerClose:function(n,t){this.trigger("close",{userTriggered:n,dialogResult:t})}});i.mvvm.DialogService=i.Class.extend({init:function(n){this.views=n},hasDialogOpen:!1,views:{},open:function(n,r){var o,c;if(!n)throw"Required [view] is missing.";var e=new t.Deferred,s=t("<div class='k-custom-dialog' />").kendoDialog({actions:r.actions,close:function(){this.destroy()}}),f=this.views[n],l=f.id,a=t(l).html(),u=s.data("kendoDialog"),h=t(i.template(a)(r.viewModel));if(u.content(h),f.cssClass){let n=u.element.closest(".k-dialog");t(n).addClass(f.cssClass)}if(f.cssContentClass){let n=s;t(n).addClass(f.cssContentClass)}return u.bind("close",function(n){e.state()!=="resolved"&&e.resolve({userTriggered:n.userTriggered,dialogResult:null})}),r.viewModel&&(i.bind(h,r.viewModel),r.viewModel instanceof i.mvvm.DialogViewModel&&r.viewModel.bind("close",function(n){e.resolve({userTriggered:n.userTriggered,dialogResult:n.dialogResult});u.close()})),r.title&&u.title(r.title),u.open(),this.hasDialogOpen=!0,r.opened&&t.proxy(r.opened(),this),o=e.promise(),c=this,o.always(function(){c.hasDialogOpen=!1}),o}});n.Model=i.mvvm.Model;n.ViewModel=i.mvvm.ViewModel;n.View=i.mvvm.View})(window,window.kendo.jQuery,window.kendo);var ApiService=function(n){function i(i,u){return n.ajax({url:r(u.area,u.controller,u.action),method:i,cache:!1,contentType:"application/json",data:u.data!=undefined?JSON.stringify(u.data):undefined,beforeSend:function(n){typeof u.username!="undefined"&&n.setRequestHeader("x-accuaccount-username",u.username);typeof u.password!="undefined"&&n.setRequestHeader("x-accuaccount-password",u.password);t.requestStart&&t.requestStart.bind(t)()},complete:function(){t.requestEnd&&t.requestEnd.bind(t)()},success:function(n){typeof u.success!="undefined"&&u.success(n);typeof t.success!="undefined"&&t.success()},error:function(n){var i={statusCode:n.status,statusDescription:n.statusText,errorMessage:n.responseJSON!=null?n.responseJSON.ErrorMessage:"A general failure occurred communicating with the server (status: "+n.statusText+").",response:n};typeof u.error!="undefined"&&u.error(i);typeof t.error!="undefined"&&t.error(i)}})}function r(n,t,i){var r="";return n===null?r+="api/":n===""||(r+="api/"),r+=t,i&&(r+="/",r+=i),r}var t={authorizationHeader:undefined,error:undefined,get:undefined,post:undefined,success:undefined,requestStart:undefined,requestEnd:undefined};return t.delete=function(n){return i("DELETE",n)},t.get=function(n){return i("GET",n)},t.patch=function(n){return i("PATCH",n)},t.post=function(n){return i("POST",n)},t.put=function(n){return i("PUT",n)},t},ErrorHandler=kendo.Class.extend({init:function(){},error:function(n){console.log(n.errorMessage)},success:function(){},warning:function(){}}),CustomerService=kendo.Class.extend({init:function(n){this._webapi=n},getCustomerDetails:function(n){return this._webapi.get({area:"",controller:kendo.format("customer({0})",n),action:""})},getModuleInformation:function(){return this._webapi.get({area:"",controller:"customer/module",action:""})},getLoans:function(n,t){return this._webapi.get({area:"",controller:kendo.format("customer({0})",n),action:kendo.format("loan?username={0}",t)})},getLoanApplications:function(n,t){return this._webapi.get({area:"",controller:kendo.format("customer({0})",n),action:kendo.format("loanapplication?username={0}",t)})},getDeposits:function(n,t){return this._webapi.get({area:"",controller:kendo.format("customer({0})",n),action:kendo.format("deposit?username={0}",t)})},getTrusts:function(n,t){return this._webapi.get({area:"",controller:kendo.format("customer({0})",n),action:kendo.format("trust?username={0}",t)})},getLoanApplicationDetails:function(n,t){return this._webapi.get({area:"",controller:kendo.format("customer({0})",n),action:kendo.format("loanapplication({0})",t)})},getLoanDetails:function(n,t){return this._webapi.get({area:"",controller:kendo.format("customer({0})",n),action:kendo.format("loan({0})",t)})},getLoanApplicationCollaterals:function(n,t,i){return this._webapi.get({area:"",controller:kendo.format("customer({0})/loanapplication({1})",n,t),action:kendo.format("collateral?user={0}",i)})},getLoanCollaterals:function(n,t,i){return this._webapi.get({area:"",controller:kendo.format("customer({0})/loan({1})",n,t),action:kendo.format("collateral?user={0}",i)})},getDeposit:function(n,t){return this._webapi.get({area:"",controller:kendo.format("customer({0})",n),action:kendo.format("deposit({0})",t)})},getDepositCollaterals:function(n,t,i){return this._webapi.get({area:"",controller:kendo.format("customer({0})/deposit({1})",n,t),action:kendo.format("collateral?username={0}",i)})},getTrustDetails:function(n,t){return this._webapi.get({area:"",controller:kendo.format("customer({0})",n),action:kendo.format("trust({0})",t)})},getTrustCollaterals:function(n,t,i){return this._webapi.get({area:"",controller:kendo.format("customer({0})/trust({1})",n,t),action:kendo.format("collateral?username={0}",i)})}}),CustomerBuilder=kendo.Class.extend({init:function(n,t){this._customerService=n;this._documentService=t},build:function(n){var t=new Customer(this._customerService,this._documentService);return t.set("id",n.Id),t.set("name",n.FullName),t.set("number",n.CustomerNumber),t.set("taxId",n.TaxId),t.set("status",n.Status),t.set("type",n.Type),t.set("officer",n.OfficerName),t.set("branch",n.BranchName),t.set("email",n.Email),t.set("isEmployee",n.IsEmployee),t.set("address",{address1:n.Address1,address2:n.Address2,city:n.City,state:n.State,zip:n.Zip}),t.set("phoneNumbers",{home:n.HomePhoneNumber,work:n.WorkPhoneNumber,mobile:n.MobilePhoneNumber}),t.set("totalLoanBalance",n.TotalLoanBalance),t.set("totalLoanCommitment",n.TotalLoanCommitment),t}}),Customer=kendo.data.Model.extend({init:function(n,t){kendo.data.Model.fn.init.call(this);this._customerService=n;this._documentService=t},id:undefined,name:undefined,number:undefined,taxId:undefined,status:undefined,type:undefined,officer:undefined,branch:undefined,email:undefined,isEmployee:undefined,address:{address1:undefined,address2:undefined,city:undefined,state:undefined,zip:undefined},phoneNumbers:{home:undefined,work:undefined,mobile:undefined},getLoanApplications:function(n,t){return this._customerService.getLoanApplications(n,t)},getLoans:function(n,t){return this._customerService.getLoans(n,t)},getDeposits:function(n,t){return this._customerService.getDeposits(n,t)},getTrusts:function(n,t){return this._customerService.getTrusts(n,t)},getDocuments:function(n,t,i,r,u){return this._documentService.getCustomerDocuments(n,t,i,r,u)},totalLoanBalance:undefined,totalLoanCommitment:undefined,_customerService:undefined}),AccountBuilder=kendo.Class.extend({init:function(n,t){this._accountService=n;this._documentService=t},build:function(n,t){var i;return i=t==="loan"?new Loan(this._accountService,this._documentService):t==="loanapp"?new LoanApplication(this._accountService,this._documentService):t==="deposit"?new Deposit(this._accountService,this._documentService):new Trust(this._accountService,this._documentService),i.set("id",n.Id),i.set("number",n.Number),i.set("branch",n.BranchName),i.set("type",n.Type),i.set("status",n.Status),i.set("officer",n.OfficerName),i.set("balance",null),i.set("commitment",null),t==="loan"&&(i.set("balance",n.Balance),i.set("commitment",n.Commitment)),t==="loanapp"&&(i.set("amountRequested",n.AmountRequested),i.set("isRenewal",n.IsRenewal)),i}}),Account=kendo.data.Model.extend({init:function(n,t,i){kendo.data.Model.fn.init.call(this);var r=this;r.kind=n;r._accountService=t;r._documentService=i},id:undefined,number:undefined,branch:undefined,kind:undefined,type:undefined,status:undefined,officer:undefined,getCollateral:function(){return[]},getDocuments:function(){return[]},_accountService:undefined,_documentService:undefined}),Loan=function(){return Account.extend({init:function(n,t){Account.fn.init.call(this,"loan",n,t)},balance:undefined,commitment:undefined,getCollateral:function(n,t){return this._accountService.getLoanCollaterals(n,this.id,t)},getDocuments:function(n,t,i,r){return this._documentService.getLoanDocuments(this.id,n,t,i,r)}})}(),LoanApplication=function(){return Account.extend({init:function(n,t){Account.fn.init.call(this,"loanapp",n,t)},amountRequested:0,getCollateral:function(n,t){return this._accountService.getLoanApplicationCollaterals(n,this.id,t)},getDocuments:function(n,t,i,r){return this._documentService.getLoanApplicationDocuments(this.id,n,t,i,r)},isRenewal:!1})}(),Deposit=function(){return Account.extend({init:function(n,t){Account.fn.init.call(this,"deposit",n,t)},getCollateral:function(n,t){return this._accountService.getDepositCollaterals(n,this.id,t)},getDocuments:function(n,t,i,r){return this._documentService.getDepositDocuments(this.id,n,t,i,r)}})}(),Trust=function(){return Account.extend({init:function(n,t){Account.fn.init.call(this,"trust",n,t)},getCollateral:function(n,t){return this._accountService.getTrustCollaterals(n,this.id,t)},getDocuments:function(n,t,i,r){return this._documentService.getTrustDocuments(this.id,n,t,i,r)}})}(),Collateral=kendo.data.Model.extend({init:function(n,t){kendo.data.Model.fn.init.call(this);var i=this;i.kind=n;i._service=t},number:undefined,kind:undefined,type:undefined,isCrossCollateral:undefined,getDocuments:function(n,t,i,r,u){var f=this;return f.kind==="loan"?this._service.getLoanCollateralDocuments(n,f.number,t,i,r,u):f.kind==="deposit"?this._service.getDepositCollateralDocuments(n,f.number,t,i,r,u):this._service.getTrustCollateralDocuments(n,f.number,t,i,r,u)},_service:undefined}),DocumentService=kendo.Class.extend({init:function(n){this._webapi=n},approve:function(n,t){return this._webapi.post({area:"",controller:kendo.format("document({0})",n),action:kendo.format("approve?username={0}",t)})},getEvent:function(n,t){return this._webapi.get({area:"",controller:kendo.format("document({0})",n),action:kendo.format("history({0})",t)})},getHistory:function(n){return this._webapi.get({area:"",controller:kendo.format("document({0})",n),action:"history"})},reject:function(n,t,i){var r=kendo.format("reject?username={0}",t);return i&&i.length>0&&(r+=kendo.format("&comment={0}",encodeURIComponent(i))),this._webapi.post({area:"",controller:kendo.format("document({0})",n),action:r})},rejectNotification:function(n,t,i){return this._webapi.post({area:"",controller:kendo.format("document({0})",n),action:kendo.format("change({0})/reject/notification?username={1}",t,i)})},getCustomerDocuments:function(n,t,i,r,u){var f=kendo.format("document(credit)?accountId={0}&username={1}&take={2}&skip={3}",n,t,i,r);return u&&u.length>0&&(f+=kendo.format("&searchText={0}",encodeURIComponent(u))),this._webapi.get({area:"",controller:f,action:""})},getLoanApplicationDocuments:function(n,t,i,r,u){var f=kendo.format("document(loanapp)?accountId={0}&username={1}&take={2}&skip={3}",n,t,i,r);return u&&u.length>0&&(f+=kendo.format("&searchText={0}",encodeURIComponent(u))),this._webapi.get({area:"",controller:f,action:""})},getLoanDocuments:function(n,t,i,r,u){var f=kendo.format("document(loan)?accountId={0}&username={1}&take={2}&skip={3}",n,t,i,r);return u&&u.length>0&&(f+=kendo.format("&searchText={0}",encodeURIComponent(u))),this._webapi.get({area:"",controller:f,action:""})},getDepositDocuments:function(n,t,i,r,u){var f=kendo.format("document(deposit)?accountId={0}&username={1}&take={2}&skip={3}",n,t,i,r);return u&&u.length>0&&(f+=kendo.format("&searchText={0}",encodeURIComponent(u))),this._webapi.get({area:"",controller:f,action:""})},getTrustDocuments:function(n,t,i,r,u){var f=kendo.format("document(trust)?accountId={0}&username={1}&take={2}&skip={3}",n,t,i,r);return u&&u.length>0&&(f+=kendo.format("&searchText={0}",encodeURIComponent(u))),this._webapi.get({area:"",controller:f,action:""})},getLoanApplicationCollateralDocuments:function(n,t,i,r,u,f){var e=kendo.format("document(loanapp)?accountId={0}&collateralNumber={1}&username={2}&take={3}&skip={4}",n,t,i,r,u);return f&&f.length>0&&(e+=kendo.format("&searchText={0}",encodeURIComponent(f))),this._webapi.get({area:"",controller:e,action:""})},getLoanCollateralDocuments:function(n,t,i,r,u,f){var e=kendo.format("document(loan)?accountId={0}&collateralNumber={1}&username={2}&take={3}&skip={4}",n,t,i,r,u);return f&&f.length>0&&(e+=kendo.format("&searchText={0}",encodeURIComponent(f))),this._webapi.get({area:"",controller:e,action:""})},getDepositCollateralDocuments:function(n,t,i,r,u,f){var e=kendo.format("document(deposit)?accountId={0}&collateralNumber={1}&username={2}&take={3}&skip={4}",n,t,i,r,u);return f&&f.length>0&&(e+=kendo.format("&searchText={0}",encodeURIComponent(f))),this._webapi.get({area:"",controller:e,action:""})},getTrustCollateralDocuments:function(n,t,i,r,u,f){var e=kendo.format("document(trust)?accountId={0}&collateralNumber={1}&username={2}&take={3}&skip={4}",n,t,i,r,u);return f&&f.length>0&&(e+=kendo.format("&searchText={0}",encodeURIComponent(f))),this._webapi.get({area:"",controller:e,action:""})}}),Document=kendo.data.Model.extend({init:function(n){kendo.data.Model.fn.init.call(this);this._documentService=n},approve:function(n){var t=this;return this._documentService.approve(this.id,n).then(function(){t.set("quality",1)})},canExpire:undefined,changeCount:undefined,comment:undefined,expirationDate:undefined,extension:undefined,getHistory:function(){return this._documentService.getHistory(this.id)},id:undefined,isExpirable:undefined,isExpired:undefined,latestChangeId:undefined,pageCount:undefined,quality:undefined,reject:function(n,t){var i=this;return this._documentService.reject(this.id,n,t).then(function(){i.set("quality",2)})},requireQC:undefined,size:undefined,tab:undefined,thumbnail:undefined,title:undefined,url:undefined}),DocumentEvent=kendo.data.ObservableObject.extend({id:undefined,author:undefined,authorEmail:undefined,date:undefined,eventSource:undefined,information:undefined,quality:undefined,pagesAdded:undefined,pagesDeleted:undefined,approvals:[],approvalCount:function(){return this.get("approvals").length},approvalStatus:function(){var n=this.get("quality");switch(n){case 1:return"Approved";case 2:return"Rejected";default:return"Not Verified"}},hasApprovals:function(){return this.get("approvals").length>0}}),DocumentChange=DocumentEvent.extend({}),DocumentChangeApproval=kendo.data.ObservableObject.extend({date:undefined,approver:undefined,comment:undefined,quality:undefined,qualityName:function(){var n=this.get("quality");switch(n){case 1:return"Approved";case 2:return"Rejected";default:return"Not Verified"}}}),DocumentViewModel=function(n,t){return ViewModel.extend({init:function(n,t){ViewModel.fn.init.call(this);this.set("document",n);this._dialogService=t},canApprove:function(){return this.get("isSelected")&&!this.isApproved()},canEdit:!0,canReject:function(){return this.get("isSelected")&&!this.isRejected()},document:null,displayId:function(){this.set("isIdVisible",!this.get("isIdVisible"))},isIdVisible:!1,isSelected:!1,isApproved:function(){return this.get("document.quality")===1},isMenuOpen:!1,isRejected:function(){return this.get("document.quality")===2},isQcRequiredAndApproved:function(){return this.get("document.requireQC")===!0&&this.isApproved()===!0},isQcRequiredAndNotApproved:function(){return this.get("document.requireQC")===!0&&this.isApproved()===!1},openHistory:function(){var n=this,t=new DocumentHistoryViewModel(this.document);this._dialogService.open("documentHistoryDialog",{title:n.document.title+" History",viewModel:t})},_dialogService:t})}(window.kendo.jQuery),RejectDialogViewModel=function(n,t){return kendo.mvvm.DialogViewModel.extend({init:function(n,t,i,r,u){kendo.mvvm.DialogViewModel.fn.init.call(this);this._documentService=n;this.document=t;this.username=i;this.userEmail=r;this.userCanSendMail=u;this.title="Reject "+t.title},author:t,authorEmail:t,cancel:function(){this.triggerClose(!0,!1)},cannotNotifyTitle:function(){return this.get("userCanSendMail")?this.get("userEmail")?this.get("authorEmail")?void 0:"The author does not have an email address configured.":"You do not have an email address configured.":"You do not have permission to send mail."},canNotifyAuthor:function(){var i=this.get("userCanSendMail"),n,t;return i?(n=this.get("authorEmail"),t=this.get("userEmail"),!t||!n)?!1:!0:!1},canReject:function(){return this.get("isBusy")===!1&&!this.get("error")},changeDate:t,comment:t,error:null,isBusy:!1,notifyAuthor:!1,onRejectFail:function(n){this.set("error",{errorMessage:n.responseJSON.ErrorMessage,errors:n.responseJSON.Errors,reason:"The document could not be rejected because a problem occurred."});throw"Reject failed";},onNotificationFail:function(n){var t=this;t.set("error",{errorMessage:n.responseJSON.ErrorMessage,errors:n.responseJSON.Errors,reason:kendo.format("The document was rejected, but {0} could not be notified because a problem occurred.",t.author)});throw"Notification failed";},reject:function(){this.set("isBusy",!0);var t=this.document.reject(this.username,this.comment),n=this;t.then(null,n.onRejectFail.bind(n)).then(function(){if(n.notifyAuthor)return n._documentService.rejectNotification(n.document.id,n.document.latestChangeId,n.username).then(null,n.onNotificationFail.bind(n))}).then(function(){n.triggerClose(!0,!0)}).always(function(){n.set("isBusy",!1)})},title:t,userCanSendMail:!1})}(window.kendo.jQuery),DocumentHistoryViewModel=function(n,t){return kendo.mvvm.DialogViewModel.extend({init:function(n){kendo.mvvm.DialogViewModel.fn.init.call(this);this.document=n;this.set("documentEvents",this._documentEventsDataSource())},document:t,documentEvents:t,_documentEventsDataSource:function(){var t=this;return new kendo.data.DataSource({transport:{read:function(n){var i=t.document.getHistory();i.done(function(t){n.success(t)})}},schema:{data:function(t){var i=[];return n.each(t,function(t,r){var u;r.Quality||r.Quality===0?(u=new DocumentChange,u.set("pagesAdded",r.PagesAdded),u.set("pagesDeleted",r.PagesRemoved),u.set("approvals",[]),u.set("quality",r.Quality),n.each(r.Approvals,function(n,t){var i=new DocumentChangeApproval;i.set("approver",t.Approver);i.set("quality",t.Quality);i.set("comment",t.Comment);i.set("date",new Date(t.Date));u.approvals.push(i)})):u=new DocumentEvent;u.set("id",r.Id);u.set("author",r.Author);u.set("authorEmail",r.AuthorEmail);u.set("date",new Date(r.Date));u.set("information",r.Information);u.set("eventSource",r.EventSource);i.push(u)}),i}},pageSize:7})},onChangeExpanded:function(n){var t=n.masterRow.eq(0),i=n.sender.dataItem(t);kendo.bind(n.detailRow,i)}})}(window.kendo.jQuery),DocumentView=View.extend({init:function(n,t,i,r,u,f,e,o){View.fn.init.call(this,t,i);this._dialogService=u;this._customerService=f;this._customerId=e;this._userId=o;r.error=function(n){console.log(n.errorMessage);console.log(n.response.responseText)}},ready:function(n,t){this._ui(n);this._events(t);var i=this._customerService.getCustomerDetails(this._customerId),r=this._customerService.getModuleInformation();i.done(function(n){t.openCustomer(n)});r.done(function(n){t.set("hasLoanApprovalModule",n.EnableLoanApprovalModule);t.set("hasLoanModule",n.EnableLoanModule);t.set("hasDepositModule",n.EnableDepositModule);t.set("hasTrustModule",n.EnableTrustModule)});$.when(i,r).done(function(){$("#left-panel, #document-toolbar, #document-pager, #document-pager .k-pager-sizes, #document-pager .k-pager-info, #footer").show();$("#search-input").focus();kendo.bind(n,t);$.active===0&&kendo.ui.progress(n,!1)})},setAccountClassTab:function(n){this.viewModel._closeAccountLists();$("#toolbar li").removeClass("selected");$(n).addClass("selected")},_events:function(n){var t=this;t.viewModel.bind("openDocument",$.proxy(t._openDocument,this));t.viewModel.bind("opendocumentmenu",$.proxy(t._openDocumentMenu,this));t.viewModel.bind("openDialog",t._openDialog);t.viewModel.bind("openEdit",t._openEdit);$("#btn-customer").click(function(){$("#toolbar li").removeClass("selected");$(this).addClass("selected");n.selectCustomer()});$("#btn-loanapplications").click(function(){t.setAccountClassTab(this);n.openLoanApplicationList();$("#loanapplications-list .content").mCustomScrollbar({theme:"dark",setHeight:"250px"})});$("#btn-loans").click(function(){t.setAccountClassTab(this);n.openLoanList();$("#loans-list .content").mCustomScrollbar({theme:"dark",setHeight:"250px"})});$("#btn-deposits").click(function(){t.setAccountClassTab(this);n.openDepositList();$("#deposits-list .content").mCustomScrollbar({theme:"dark",setHeight:"250px"})});$("#btn-trusts").click(function(){t.setAccountClassTab(this);n.openTrustList();$("#trusts-list .content").mCustomScrollbar({theme:"dark",setHeight:"250px"})});$("body").mousedown(function(t){t.target.className!=="account-list"&&$(t.target).parents(".account-list").length===0&&n._closeAccountLists()});$("#search-input").keypress(function(t){t.which===13&&n.search()})},_openDialog:function(n){n.dialog==="rejectDialog"&&$("#reject-comment").focus()},_openDocument:function(n){var t;if(n.extension)if(n.extension===".pdf"&&n.pageCount>0){var i=$(window).width()*.85,r=$(window).height()*.85,t=kendo.format("{0}?userId={1}&dispositionType=inline",n.url,this._userId),u=$("<div><\/div>").kendoWindow({title:n.title,content:t,iframe:!0,width:i,height:r,modal:!0,actions:["Maximize","Close"]}).data("kendoWindow");u.center().open()}else t=kendo.format("{0}?userId={1}&dispositionType=attachment",n.url,this._userId),window.open(t,"_self","toolbar=no, menubar=no, location=no, scrollbars=yes, resizable=yes");else this._openErrorDialog(n)},_openDocumentMenu:function(n){var u=$(n.event.currentTarget).closest(".document"),t=$(u).find(".thumb-container"),i=$(t).find(".thumb"),r=$(t).find(".actionsheet");$(i).is(":visible")?kendo.fx($(t)).flip("horizontal",i,r).play():kendo.fx($(t)).flip("horizontal",r,i).play()},_openEdit:function(n){window.location=kendo.format("accuimg://accuaccount/open?document={0}",n.id)},_openErrorDialog:function(n){var t=$("<div><\/div>").kendoDialog({content:"<span>There was a problem accessing the file, please try again later.<\/span><br/><br/>You may see this error if the file is in use, such as another user adding or removing pages. In this case, try again later. Otherwise, if you feel there is an error, contact your system administrator for further guidance.",modal:!0,width:"640px",closable:!0,visible:!1}).data("kendoDialog");t.title("Cannot open "+n.title);t.open()},_ui:function(n){var t=this;$("#document-pager").kendoPager({dataSource:t.viewModel.documents,pageSizes:[6,10,25],autoBind:!1});n.kendoTooltip({filter:"a[title]:not(a[title='']), span[title]:not(span[title='']), i[title]:not(i[title=''])",position:"top"});$(document).ajaxStart(function(){$.active>0&&(t._dialogService.hasDialogOpen||kendo.ui.progress($("body"),!0))});$(document).ajaxStop(function(){$.active<1&&kendo.ui.progress($("body"),!1)})}}),CustomerViewModel=function(n,t){var i="customer",r="account",u="collateral";return ViewModel.extend({init:function(n,t,i,r,u,f,e){ViewModel.fn.init.call(this);this._customerService=n;this._documentService=t;this._dialogService=i;this.customerId=e;this.user=r;this.userEmail=u;this.userCanSendMail=f;var o=this;o.set("documents",o._documentsDataSource());o.set("loanApplications",o._loanApplicationsDataSource());o.set("loans",o._loansDataSource());o.set("deposits",o._depositsDataSource());o.set("trusts",o._trustsDataSource());o.set("collaterals",o._collateralsDataSource())},abbreviatedTotalLoanBalance:function(){var n=this.get("customer");return this._getAbbreviatedNumber(n.totalLoanBalance)},abbreviatedTotalLoanCommitment:function(){var n=this.get("customer");return this._getAbbreviatedNumber(n.totalLoanCommitment)},approveDocuments:function(){var i=this,r=this.get("documents").view(),t=[];return n.each(r,function(n,r){if(r.canApprove()){var u=r.document.approve(i.user).then(function(){r.set("isSelected",!1)});t.push(u)}}),n.when.apply(n,t)},balances:function(){var n=this.get("customer");if(n)return[{name:"Balance",value:n.totalLoanBalance},{name:"Commitment",value:n.totalLoanCommitment}]},canApproveDocuments:function(){var t=!1,i=this.get("documents").view();return n.each(i,function(n,i){i.canApprove()&&(t=!0)}),t},canRejectDocument:function(){var t=0,i=this.get("documents").view();return n.each(i,function(n,i){i.canReject()&&t++}),t===1},collaterals:t,customer:t,deposits:t,documents:t,filterText:t,hasCollaterals:function(){return this.get("collaterals").data().length>0},hasDeposits:function(){return this.get("deposits").data().length>0},hasDepositModule:!1,hasDocuments:function(){return this.get("documents").data().length>0},hasLoanApplications:function(){return this.get("loanApplications").data().length>0},hasLoanApprovalModule:!1,hasLoans:function(){return this.get("loans").data().length>0},hasLoanModule:!1,hasTotals:function(){var n=this.get("customer");if(n)return n.totalLoanBalance===0&&n.totalLoanCommitment===0?!1:!0},hasTrusts:function(){return this.get("trusts").data().length>0},hasTrustModule:!1,includeCrossCollateral:!1,isDepositListOpen:!1,isLoanApplicationListOpen:!1,isLoanListOpen:!1,isTrustListOpen:!1,loans:t,openCustomer:function(n){var r=new CustomerBuilder(this._customerService,this._documentService),t=r.build(n);this.set("customerId",t.id);this.set("customer",t);this._currentView=i;this.documents.page(1)},openDepositList:function(){var n=this;this.deposits.fetch().then(function(){n.set("isDepositListOpen",!0)})},openDocument:function(n){this.trigger("openDocument",n.data.document)},openDocumentMenu:function(n){var t=n.data,i=t.get("isMenuOpen");t.set("isMenuOpen",!i);this.trigger("opendocumentmenu",{event:n,document:t})},openEdit:function(n){this.trigger("openEdit",n.data.document)},openLoanApplicationList:function(){var n=this;this.loanApplications.fetch().then(function(){n.set("isLoanApplicationListOpen",!0)})},openLoanList:function(){var n=this;this.loans.fetch().then(function(){n.set("isLoanListOpen",!0)})},openTrustList:function(){var n=this;this.trusts.fetch().then(function(){n.set("isTrustListOpen",!0)})},rejectDocument:function(){var n=this,f=this.get("documents").view(),i=f.find(function(n){return n.isSelected===!0}),r=i.document,u,t;i.canReject()&&(u=this._documentService.getEvent(r.id,r.latestChangeId),t=new RejectDialogViewModel(n._documentService,r,n.user,n.userEmail,n.userCanSendMail),u.then(function(i){return t.set("changeDate",i.Date),t.set("author",i.Author),t.set("authorEmail",i.AuthorEmail),n.showRejectPrompt(t)}).then(function(n){n.userTriggered&&n.dialogResult===!0&&i.set("isSelected",!1)}))},selectAccount:function(n){var t=this,i=n.target.dataset.class,u;u=i==="loan"?t._customerService.getLoanDetails(t.customer.id,n.data.Id):i==="loanapp"?t._customerService.getLoanApplicationDetails(t.customer.id,n.data.Id):i==="deposit"?t._customerService.getDeposit(t.customer.id,n.data.Id):t._customerService.getTrustDetails(t.customer.id,n.data.Id);u.done(function(n){var u=new AccountBuilder(t._customerService,t._documentService),f=u.build(n,i);t.set("selectedAccount",f);t.set("selectedCollateral",{});t._currentView=r;t.documents.page(1);t.collaterals.read().then(function(){t._closeAccountLists()});t.set("totalsIsVisible",!1)})},selectCollateral:function(n){var t=this,i=n.data;t.set("selectedCollateral",i);t._currentView=u;t.documents.page(1)},selectCustomer:function(){this._closeAccountLists();this.set("selectedAccount",{});this.set("selectedCollateral",{});this.set("totalsIsVisible",!0);this._currentView=i;this.documents.page(1)},selectedAccount:{},selectedCollateral:{},search:function(){this.documents.page(1)},showRejectPrompt:function(n){var t=this;return t._dialogService.open("rejectDialog",{title:n.title,viewModel:n,opened:function(){t.trigger("openDialog",{dialog:"rejectDialog"})}})},totalsIsVisible:!0,trusts:t,user:t,userEmail:t,userCanSendMail:t,_closeAccountLists:function(){this.set("isLoanApplicationListOpen",!1);this.set("isLoanListOpen",!1);this.set("isDepositListOpen",!1);this.set("isTrustListOpen",!1)},_collateralsDataSource:function(){var t=this;return new kendo.data.DataSource({transport:{read:function(n){var i=t.selectedAccount.getCollateral(t.customer.id,t.user);i.fail(function(t){n.error(t)});i.done(function(t){n.success(t)})}},schema:{data:function(i){var r=[];return n.each(i,function(n,i){var u=new Collateral(t.selectedAccount.kind,t._documentService);u.set("number",i.Number);u.set("status",i.Status);u.set("type",i.Type);u.set("isCrossCollateral",i.IsCrossCollateral);u.isCrossCollateral===!0?t.includeCrossCollateral===!0&&r.push(u):r.push(u)}),r}}})},_currentView:t,_customerService:t,_depositsDataSource:function(){var n=this;return new kendo.data.DataSource({transport:{read:function(t){var i=n.customer.getDeposits(n.customer.id,n.user);i.fail(function(n){t.error(n)});i.done(function(n){t.success(n)})}},schema:{type:"json",model:{fields:{number:{field:"Number"},type:{field:"Type"}}}}})},_dialogService:t,_documentsDataSource:function(){var t=this;return new kendo.data.DataSource({transport:{read:function(n){var e,f,o=t.get("filterText"),s=t._currentView;switch(s){case i:f=t.get("customer");e=f.getDocuments(t.customer.id,t.user,n.data.take,n.data.skip,o);break;case r:f=t.get("selectedAccount");e=f.getDocuments(t.user,n.data.take,n.data.skip,o);break;case u:f=t.get("selectedCollateral");e=f.getDocuments(t.selectedAccount.id,t.user,n.data.take,n.data.skip,o);break;default:throw"value of _currentView is not a supported view.";}e.fail(function(t){n.error(t)});e.done(function(t){n.success(t)})}},page:1,pageSize:6,serverPaging:!0,schema:{data:function(i){var r=[];return n.each(i.Documents,function(n,i){var u=new Document(t._documentService),f;u.set("id",i.Id);u.set("canExpire",i.CanExpire);u.set("comment",i.Comment);u.set("changeCount",i.ChangeCount);u.set("expirationDate",i.ExpirationDate);u.set("extension",i.Extension);u.set("isExpired",i.IsExpired);u.set("pageCount",i.PageCount);u.set("size",i.Size);u.set("quality",i.Quality);u.set("tab",i.Tab);u.set("thumbnail",i.ThumbnailUri);u.set("title",i.Title);u.set("url",i.Uri);u.set("latestChangeId",i.LatestChangeId);u.set("isExpirable",i.IsExpirable);u.set("requireQC",i.RequireQC);f=new DocumentViewModel(u,t._dialogService);f.set("canEdit",i.CanEdit);r.push(f)}),r},total:function(n){return n.Total}}})},_documentService:t,_getAbbreviatedNumber:function(n){return n>999?(n/1e3).toFixed(0)+"K":n>999999?(n/1e6).toFixed(0)+"M":n},_loanApplicationsDataSource:function(){var n=this;return new kendo.data.DataSource({transport:{read:function(t){var i=n.customer.getLoanApplications(n.customer.id,n.user);i.fail(function(n){t.error(n)});i.done(function(n){t.success(n)})}},schema:{type:"json",model:{fields:{number:{field:"Number"},type:{field:"Type"}}}}})},_loansDataSource:function(){var n=this;return new kendo.data.DataSource({transport:{read:function(t){var i=n.customer.getLoans(n.customer.id,n.user);i.fail(function(n){t.error(n)});i.done(function(n){t.success(n)})}},schema:{type:"json",model:{fields:{number:{field:"Number"},type:{field:"Type"}}}}})},_trustsDataSource:function(){var n=this;return new kendo.data.DataSource({transport:{read:function(t){var i=n.customer.getTrusts(n.customer.id,n.user);i.fail(function(n){t.error(n)});i.done(function(n){t.success(n)})}},schema:{type:"json",model:{fields:{number:{field:"Number"},type:{field:"Type"}}}}})}})}(window.kendo.jQuery);