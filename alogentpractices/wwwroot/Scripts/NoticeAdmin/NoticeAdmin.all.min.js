var ApiService=function(n){function i(i,u){return n.ajax({url:r(u.area,u.controller,u.action),method:i,cache:!1,contentType:"application/json",data:u.data!=undefined?JSON.stringify(u.data):undefined,beforeSend:function(n){typeof u.username!="undefined"&&n.setRequestHeader("x-accuaccount-username",u.username);typeof u.password!="undefined"&&n.setRequestHeader("x-accuaccount-password",u.password);t.requestStart&&t.requestStart.bind(t)()},complete:function(){t.requestEnd&&t.requestEnd.bind(t)()},success:function(n){typeof u.success!="undefined"&&u.success(n);typeof t.success!="undefined"&&t.success()},error:function(n){var i={statusCode:n.status,statusDescription:n.statusText,errorMessage:n.responseJSON!=null?n.responseJSON.ErrorMessage:"A general failure occurred communicating with the server (status: "+n.statusText+").",response:n};typeof u.error!="undefined"&&u.error(i);typeof t.error!="undefined"&&t.error(i)}})}function r(n,t,i){var r="";return n===null?r+="api/":n===""||(r+="api/"),r+=t,i&&(r+="/",r+=i),r}var t={authorizationHeader:undefined,error:undefined,get:undefined,post:undefined,success:undefined,requestStart:undefined,requestEnd:undefined};return t.delete=function(n){return i("DELETE",n)},t.get=function(n){return i("GET",n)},t.patch=function(n){return i("PATCH",n)},t.post=function(n){return i("POST",n)},t.put=function(n){return i("PUT",n)},t};(function(n,t,i){i.mvvm||(i.mvvm={});i.mvvm.Model=i.data.Model.extend({init:function(){i.data.Model.fn.init.call(this)}});i.mvvm.View=i.Class.extend({init:function(n,i){var r=this;r.viewModel=i;t(document).ready(t.proxy(r._ready,r,t(n),i))},_ready:function(n,r){t("[data-role='pageload']").remove();i.ui.progress(n,!0);this.ready(n,r)},ready:function(n,t){i.bind(n,t);i.ui.progress(n,!1)}});i.mvvm.ViewModel=i.data.ObservableObject.extend({init:function(){i.data.ObservableObject.fn.init.call(this,this)}});i.mvvm.DialogViewModel=i.mvvm.ViewModel.extend({init:function(){ViewModel.fn.init.call(this)},triggerClose:function(n,t){this.trigger("close",{userTriggered:n,dialogResult:t})}});i.mvvm.DialogService=i.Class.extend({init:function(n){this.views=n},hasDialogOpen:!1,views:{},open:function(n,r){var o,c;if(!n)throw"Required [view] is missing.";var e=new t.Deferred,s=t("<div class='k-custom-dialog' />").kendoDialog({actions:r.actions,close:function(){this.destroy()}}),f=this.views[n],l=f.id,a=t(l).html(),u=s.data("kendoDialog"),h=t(i.template(a)(r.viewModel));if(u.content(h),f.cssClass){let n=u.element.closest(".k-dialog");t(n).addClass(f.cssClass)}if(f.cssContentClass){let n=s;t(n).addClass(f.cssContentClass)}return u.bind("close",function(n){e.state()!=="resolved"&&e.resolve({userTriggered:n.userTriggered,dialogResult:null})}),r.viewModel&&(i.bind(h,r.viewModel),r.viewModel instanceof i.mvvm.DialogViewModel&&r.viewModel.bind("close",function(n){e.resolve({userTriggered:n.userTriggered,dialogResult:n.dialogResult});u.close()})),r.title&&u.title(r.title),u.open(),this.hasDialogOpen=!0,r.opened&&t.proxy(r.opened(),this),o=e.promise(),c=this,o.always(function(){c.hasDialogOpen=!1}),o}});n.Model=i.mvvm.Model;n.ViewModel=i.mvvm.ViewModel;n.View=i.mvvm.View})(window,window.kendo.jQuery,window.kendo);var PlaceholderVisualizer=function(n,t){const i=/<template-placeholder\s+[^>]*data-identifier="([^"]+)"[^>]*>[\s\S]*?<\/template-placeholder>/gis,r=/\[placeholder:\s*([a-f0-9\-]{36})\]/gis;return t.Class.extend({createPlaceholderElement:function(i,r){let f=r,u=t.template(n("#noticeplaceholder-template").html())(f);u=u.trim();i.paste(u,!0);setTimeout(()=>{i.focus();let n=i.getRange(),t=n.endContainer.parentNode;n.selectNode(t);n.collapse();i.selectRange(n)})},devisualizeText:function(n){return n.replace(i,(n,t)=>`[placeholder: ${t}]`)},visualizeText:function(i,u){return i.replace(r,(i,r)=>{var f=u.find(n=>n.id==r);if(f){let i=n("#noticeplaceholder-template").html(),r=t.template(i)(f);return r.trim()}return i})}})}(window.kendo.jQuery,window.kendo,undefined),NoticeClient=function(){return kendo.Class.extend({init:function(n){this.api=n},api:undefined,getNoticeLetterSet:function(){return this.api.get({area:"",controller:"noticeletterset",action:""})},postNoticeLetterSet:function(n){return this.api.post({area:"",controller:"noticeletterset",action:"",data:n})},patchNoticeLetterSet:function(n){return this.api.patch({area:"",controller:"noticeletterset",action:n.id,data:n})},deleteNoticeLetterSet:function(n){return this.api.delete({area:"",controller:"noticeletterset",action:n.id})},getExceptionPolicies:function(n){return this.api.get({area:"",controller:"exceptionpolicy",action:`?type=${n}`})},deleteExceptionPolicy:function(n,t){return this.api.delete({area:"",controller:"noticeletterset",action:`${n}/exceptionpolicy/${t}`})},deleteTemplate:function(n,t){return this.api.delete({area:"",controller:"noticeletterset",action:`${n}/template/${t}`})},getPlaceholders:function(){return this.api.get({area:"",controller:"notice/admin",action:"placeholder"})},patchTemplate:function(n,t,i){return this.api.patch({area:"",controller:"noticeletterset",action:`${n}/template/${t}`,data:i})},postExceptionPolicy:function(n,t){return this.api.post({area:"",controller:"noticeletterset",action:`${n}/exceptionpolicy/${t}`})},putStage:function(n,t){return this.api.put({area:"",controller:"noticeletterset",action:`${n}/stage`,data:t})},postTemplate:function(n,t){return this.api.post({area:"",controller:"noticeletterset",action:`${n}/template`,data:t})},maps:{mapNoticeLetterSet:function(n){return{id:n.Id,name:n.Name,isEnabled:n.IsEnabled,isMailMergeEnabled:n.IsMailMergeEnabled,exceptionPolicies:n.ExceptionPolicies==null?[]:n.ExceptionPolicies.map(n=>this.mapExceptionPolicy(n)),templates:n.Templates==null?[]:n.Templates.map(n=>this.mapTemplate(n))}},mapExceptionPolicy:function(n){return{id:n.Id,name:n.Name,documentType:n.DocumentType,accountType:n.AccountType,type:n.Type,accountClass:n.Class}},mapPlaceholder:function(n){return{id:n.Identifier,label:n.Label,"class":n.Class}},mapTemplate:function(n){return{id:n.Id,name:n.Name,isEnabled:n.IsEnabled,templateHeader:n.Header,templateBody:n.Body,templateFooter:n.Footer,stage:n.Stage,daysBeforeNext:n.DaysBeforeNext,exceptionPolicies:n.ExceptionPolicies.map(n=>this.mapTemplateExceptionPolicy(n))}},mapTemplateExceptionPolicy:function(n){return{exceptionPolicyId:n.ExceptionPolicyId,daysBeforeNext:n.DaysBeforeNext}}}})}(),NoticeAdminExceptionPolicyDataSource=function(n,t){return function(n){return new t.data.DataSource({data:n,pageSize:10,group:[{field:"type"}],sort:[{field:"accountClass",dir:"asc"},{field:"accountType",dir:"asc"},{field:"type",dir:"desc"},{field:"name",dir:"asc"}]})}}(window.kendo.jQuery,window.kendo,undefined),NoticeLetterSetExceptionPolicyModel=function(n,t){return t.data.ObservableObject.extend({init:function(n){t.data.ObservableObject.fn.init.call(this,this);n!=null&&(this.set("id",n.id),this.set("name",n.name),this.set("type",n.type),this.set("accountClass",n.accountClass),this.set("accountType",n.accountType),this.set("documentType",n.documentType))},id:null,name:null,type:null,accountClass:null,accountType:null,documentType:null,selected:!1})}(window.kendo.jQuery,window.kendo),NoticeLetterTemplateExceptionPolicy=function(n,t){return t.data.ObservableObject.extend({init:function(n){t.data.ObservableObject.fn.init.call(this,this);n!=null&&(this.set("id",n.id),this.set("type",n.type),this.set("accountClass",n.accountClass),this.set("accountType",n.accountType),this.set("name",n.name),this.set("daysBeforeNext",0),this.set("override",!1),this.set("editDaysBeforeNext",0),this.set("editOverride",!1))},enableExceptionPolicyOverride:function(){this.set("editOverride",!0)},disableExceptionPolicyOverride:function(){this.set("editOverride",!1)}})}(window.kendo.jQuery,window.kendo),NoticeLetterSetTemplateModel=function(n,t,i){return t.data.ObservableObject.extend({init:function(n,i,r){t.data.ObservableObject.fn.init.call(this,this);this.set("exceptionPolicies",new t.data.DataSource({sort:[{field:"accountClass",dir:"asc"},{field:"accountType",dir:"asc"},{field:"type",dir:"desc"},{field:"name",dir:"asc"}]}));this.set("placeholders",new t.data.DataSource({transport:{read:function(n){let t=r.getPlaceholders();t.done(t=>{let i=t.map(n=>r.maps.mapPlaceholder(n));n.success(i)});t.fail(function(t){n.error(t)})}},group:{field:"class",dir:"asc"},sort:[{field:"class",dir:"asc"},{field:"label",dir:"asc"}]}));n!=null&&(this.set("id",n.id),this.set("name",n.name),this.set("isEnabled",n.isEnabled),this.set("stage",n.stage),this.set("daysBeforeNext",n.daysBeforeNext),this.set("templateHeader",n.templateHeader),this.set("templateBody",n.templateBody),this.set("templateFooter",n.templateFooter),i.forEach(n=>{this.exceptionPolicies.add(new NoticeLetterTemplateExceptionPolicy(n))}),n.exceptionPolicies.forEach(n=>{let t=this.exceptionPolicies.data().find(t=>t.id==n.exceptionPolicyId);t!=null&&(t.set("override",!0),t.set("daysBeforeNext",n.daysBeforeNext),t.set("editDaysBeforeNext",n.daysBeforeNext))}))},id:null,name:"",isEnabled:!0,editMode:!1,editName:"",editDaysBeforeNext:0,editIsEnabled:!0,editStage:0,editTemplateHeader:"",editTemplateBody:"",editTemplateFooter:"",placeholderVisualizer:new PlaceholderVisualizer,applyChanges:function(){this.set("name",this.editName);this.set("isEnabled",this.editIsEnabled);this.set("daysBeforeNext",this.editDaysBeforeNext);this.set("templateHeader",this.devisualizeText(this.editTemplateHeader));this.set("templateBody",this.devisualizeText(this.editTemplateBody));this.set("templateFooter",this.devisualizeText(this.editTemplateFooter));this.exceptionPolicies.data().forEach(n=>{n.set("override",n.editOverride),n.set("daysBeforeNext",n.editDaysBeforeNext)});this.set("editMode",!1);this.set("isDirty",!1)},cancelEdit:function(){this.set("editName",this.name);this.set("editDaysBeforeNext",this.daysBeforeNext);this.set("editIsEnabled",this.isEnabled);this.set("editTemplateHeader",this.visualizeText(this.templateHeader));this.set("editTemplateBody",this.visualizeText(this.templateBody));this.set("editTemplateFooter",this.visualizeText(this.templateFooter));this.exceptionPolicies.data().forEach(n=>{n.set("editOverride",n.override),n.set("editDaysBeforeNext",n.daysBeforeNext)});this.set("editMode",!1);this.set("isDirty",!1)},edit:function(){let n=this.placeholders.fetch();n.done(()=>{this.set("editName",this.name),this.set("editDaysBeforeNext",this.daysBeforeNext),this.set("editIsEnabled",this.isEnabled),this.set("editTemplateHeader",this.visualizeText(this.templateHeader)),this.set("editTemplateBody",this.visualizeText(this.templateBody)),this.set("editTemplateFooter",this.visualizeText(this.templateFooter)),this.set("editMode",!0),this.exceptionPolicies.data().forEach(n=>{n.set("editOverride",n.override),n.set("editDaysBeforeNext",n.daysBeforeNext)})})},devisualizeText:function(n){return this.placeholderVisualizer.devisualizeText(n)},getPreviewText:function(){let n=this.get("templateHeader"),t=this.get("templateBody"),i=this.get("templateFooter"),r=`${n}${t}${i}`;return this.visualizeText(r)},visualizeText:function(n){return this.placeholderVisualizer.visualizeText(n,this.placeholders.data())},isNew:function(){return this.get("id")==""||this.get("id")==i||this.get("id")==null},hasExceptionPolicyOverrides:function(){let n=this.exceptionPolicies.data();return n.some(n=>n.override==!0)},isStageChanged:function(){let n=this.get("editStage"),t=this.get("stage");return n==0?!1:n!=t},isUpdating:function(){return this.isNew()?!1:this.get("editMode")},isValid:function(){return this.get("editName")!=""},reset:function(){this.set("editName",null);this.set("editIsEnabled",null);this.set("isDirty",!1)},onPlaceholderSelected:function(t){if(t.dataItem!=null){t.preventDefault();let i=n(t.sender.element).data("editor"),r=n(i).data("kendoEditor");this.placeholderVisualizer.createPlaceholderElement(r,t.dataItem)}},templateHeader:"",templateBody:"",templateFooter:""})}(window.kendo.jQuery,window.kendo),NoticeLetterSetModel=function(n,t,i){return t.data.ObservableObject.extend({_noticeClient:null,_dialogService:null,init:function(n,i,r,u,f){t.data.ObservableObject.fn.init.call(this,this);this._noticeClient=i;this._dialogService=u;this._focusManager=f;this.set("unassignedExceptionPolicies",new NoticeAdminExceptionPolicyDataSource(r));this.set("templates",new t.data.DataSource({sort:[{field:"stage",dir:"asc"}]}));this.set("exceptionPolicies",new t.data.DataSource({sort:[{field:"accountClass",dir:"asc"},{field:"accountType",dir:"asc"},{field:"type",dir:"desc"},{field:"name",dir:"asc"}]}));n!=null&&(this.set("id",n.id),this.set("name",n.name),this.set("isEnabled",n.isEnabled),this.set("isMailMergeEnabled",n.isMailMergeEnabled),this.exceptionPolicies.data(n.exceptionPolicies.map(n=>new NoticeLetterSetExceptionPolicyModel(n))),this.templates.data(n.templates.map(n=>new NoticeLetterSetTemplateModel(n,this.exceptionPolicies.data(),this._noticeClient))))},id:null,name:"",isEnabled:!0,isMailMergeEnabled:!1,editMode:!1,editName:"",editIsEnabled:!0,editIsMailMergeEnabled:!1,exceptionPolicies:[],unassignedExceptionPolicies:[],selectedExceptionsTab:"Active",selectedTemplate:null,stageMode:!1,templates:[],addTemplate:function(){let t=1;this.templates.data().forEach(()=>t++);let n=new NoticeLetterSetTemplateModel({name:"New Template",isEnabled:!1,stage:t,templateHeader:"",templateBody:"",templateFooter:"",daysBeforeNext:0,exceptionPolicies:[]},this.exceptionPolicies.data(),this._noticeClient);n.edit();this.templates.add(n);this.set("selectedTemplate",n);this._focusManager.trigger("focus",{target:"template.name"})},applyChanges:function(){this.set("name",this.editName);this.set("isEnabled",this.editIsEnabled);this.set("isMailMergeEnabled",this.editIsMailMergeEnabled);this.set("editMode",!1);this.set("isDirty",!1)},cancelEdit:function(){this.set("editMode",!1)},cancelStageMode:function(){this.templates.sort({field:"editStage",dir:"asc"});this.templates.data().forEach(n=>{n.set("editStage",n.stage)});this.set("stageMode",!1)},cancelTemplate:function(n){let t=n.data;t.isNew()&&this.templates.remove(t);t.cancelEdit();this.set("selectedTemplate",null);this._focusManager.trigger("focus",{target:"top"})},commitStageMode:function(){let n=null,t=this._dialogService.open("confirmStageOrder",{title:"Confirm",viewModel:this,actions:[{text:"OK",primary:!0,action:()=>(n=!0,!0)},{text:"Cancel",action:()=>(n=!1,!0)}]});t.done(()=>{if(n!=!1){let t={stages:[]};this.templates.data().forEach(n=>{t.stages.push({templateId:n.id,stage:n.editStage})});let i=this._noticeClient.putStage(this.id,t);i.done(()=>{this.templates.data().forEach(n=>{n.set("stage",n.editStage)}),this.templates.sort({field:"editStage",dir:"asc"}),this.set("stageMode",!1)})}})},createTemplate:function(n){let t=n.data,i={name:t.editName,isEnabled:t.editIsEnabled,daysBeforeNext:t.editDaysBeforeNext,header:t.editTemplateHeader,body:t.editTemplateBody,footer:t.editTemplateFooter,exceptionPolicies:t.exceptionPolicies.data().filter(n=>n.editOverride).map(n=>({exceptionPolicyId:n.id,daysBeforeNext:n.editDaysBeforeNext}))},r=this._noticeClient.postTemplate(this.id,i),u=this;r.done(n=>{t.applyChanges(),t.isNew()&&t.set("id",n.Id),u.set("selectedTemplate",null),this._focusManager.trigger("focus",{target:"top"})})},deleteTemplate:function(n){let r=n.data,i=this;t.confirm("Are you sure you want to delete this template?").done(function(){let n=i._noticeClient.deleteTemplate(i.id,r.id);n.done(function(){i.templates.remove(r);i.set("selectedTemplate",null);i.templates.data().forEach(n=>{n.stage>r.stage&&n.set("stage",n.stage-1)})})})},edit:function(){this.set("editName",this.name);this.set("editIsEnabled",this.isEnabled);this.set("editIsMailMergeEnabled",this.isMailMergeEnabled);this.set("editMode",!0)},editStages:function(){this.templates.sort({field:"editStage",dir:"asc"});this.set("stageMode",!0)},editTemplate:function(n){let t=n.data;this.set("selectedTemplate",t);t.edit()},isNew:function(){return this.get("id")==""||this.get("id")==i||this.get("id")==null},isUpdating:function(){return this.isNew()?!1:this.get("editMode")||this.get("stageMode")?!0:this.get("templates").data().some(n=>n.get("editMode"))},isValid:function(){return this.get("editName")!=""},reset:function(){this.set("editName",null);this.set("editIsEnabled",null);this.set("editIsMailMergeEnabled",null);this.set("isDirty",!1)},disableExceptionPolicy:function(n){let u=t.confirm(`Are you sure you want to revoke the policy for ${n.data.name} exceptions from this letter set?<br /><br />Revoking this policy will remove all associated configuration and disable the ability to create and send notice letters for this type of exception.`),i=this,r=n.data;u.done(function(){let n=i._noticeClient.deleteExceptionPolicy(i.id,r.id);n.done(()=>{i.exceptionPolicies.remove(r),i.templates.data().forEach(n=>{let t=n.exceptionPolicies.data().find(n=>n.id==r.id);t!=null&&n.exceptionPolicies.remove(t)})})})},enableExceptionPolicy:function(n){let r=n.data,u=t.confirm(`Are you sure you want to assign the policy for ${n.data.name} exceptions to this letter set?<br /><br />This will enable the ability to create and send notice letters for this type of exception.`),i=this;u.done(()=>{let n=i._noticeClient.postExceptionPolicy(i.id,r.id);n.done(()=>{i.exceptionPolicies.add(r),i.templates.data().forEach(n=>{n.exceptionPolicies.add(new NoticeLetterTemplateExceptionPolicy(r))})})})},canEnableExceptionPolicies:function(){let n=this.get("unassignedExceptionPolicies").view();return n.some(n=>n.items.some(n=>n.selected))},canStage:function(){let n=this.get("templates").data();return n.length>1},canUpdateStage:function(){let n=this.get("templates").data();return n.some(n=>{let i=n.get("stage"),t=n.get("editStage");return t==0?!1:i!=t})},updateTemplate:function(n){let t=n.data,i={name:t.editName,isEnabled:t.editIsEnabled,daysBeforeNext:t.editDaysBeforeNext,header:t.devisualizeText(t.editTemplateHeader),body:t.devisualizeText(t.editTemplateBody),footer:t.devisualizeText(t.editTemplateFooter),exceptionPolicies:t.exceptionPolicies.data().filter(n=>n.editOverride).map(n=>({exceptionPolicyId:n.id,daysBeforeNext:n.editDaysBeforeNext}))},r=this._noticeClient.patchTemplate(this.id,t.id,i),u=this;r.done(()=>{t.applyChanges(),u.set("selectedTemplate",null),this._focusManager.trigger("focus",{target:"top"})})},updateUnassignedExceptionPoliciesFilter:function(n){let t=[];n.forEach(n=>t.push({field:"id",value:n,operator:"neq"}));this.unassignedExceptionPolicies.filter(t)},isExceptionPoliciesVisible:function(){return this.isNew()?!1:this.get("selectedTemplate.editMode")?!1:!0}})}(window.kendo.jQuery,window.kendo),NoticeAdminViewModel=function(n,t){return ViewModel.extend({init:function(n,i){ViewModel.fn.init.call(this);this._webapi=n;this._noticeClient=new NoticeClient(n);this._dialogService=i;let r=this;this.bind("change",n=>{n.field=="selectedSet.stageMode"&&this.get("selectedSet.stageMode")==!0&&this.trigger("ui.stage",{data:this.selectedSet})});this.set("exceptionPolicies",new t.data.DataSource({transport:{read:function(n){let t=r._noticeClient.getExceptionPolicies("standard");t.done(t=>{let i=t.map(n=>r._noticeClient.maps.mapExceptionPolicy(n)),u=i.map(n=>new NoticeLetterSetExceptionPolicyModel(n));n.success(u)});t.fail(function(t){n.error(t)})}}}));this.set("sets",new t.data.DataSource({transport:{read:function(n){let t=r._noticeClient.getNoticeLetterSet();t.done(function(t){let u=t.map(n=>r._noticeClient.maps.mapNoticeLetterSet(n)),i=u.map(n=>new NoticeLetterSetModel(n,r._noticeClient,r.exceptionPolicies.view(),r._dialogService,r));n.success(i);r.updateExceptionPoliciesFilter(i);i.forEach(n=>{n.bind("change",r.onSelectedSetChange.bind(r))})});t.fail(function(t){n.error(t)})}},sort:[{field:"name",dir:"asc"}]}))},addSet:function(){let n=new NoticeLetterSetModel({name:"New Notice Letter Set",isEnabled:!0,isMailMergeEnabled:!1,exceptionPolicies:[],templates:[]},this._noticeClient,this.exceptionPolicies.view(),this._dialogService,this);this.sets.add(n);this.trigger("selectset",{item:n});this.editSet();this.trigger("focus",{target:"setname"})},cancelSetEdit:function(){let n=this.selectedSet;if(n.reset(),n.isNew()){this.sets.remove(n);this.set("selectedSet",null);return}this.selectedSet.cancelEdit()},createSet:function(){let t={name:this.selectedSet.editName,isEnabled:this.selectedSet.editIsEnabled,isMailMergeEnabled:this.selectedSet.editIsMailMergeEnabled,exceptionPolicies:[],templates:[]},i=this._noticeClient.postNoticeLetterSet(t),n=this;i.done(function(t){n.selectedSet.applyChanges();n.selectedSet.isNew()&&(n.selectedSet.set("id",t.Id),n.updateExceptionPoliciesFilter(n.sets.data()))})},deleteSet:function(){let n=this.selectedSet;if(this.selectedSet.isNew()){this.sets.remove(n);this.set("selectedSet",null);return}let i=this;t.confirm("Are you sure you want to delete this set? It will delete all of its templates and configuration.").done(function(){let t=i._noticeClient.deleteNoticeLetterSet(n);t.done(function(){i.sets.remove(n);i.set("selectedSet",null)})})},editSet:function(){this.selectedSet!=null&&(this.selectedSet.edit(),this.trigger("focus",{target:"setname"}))},isSetVisible:function(){return this.get("selectedSet")==null?!1:this.get("selectedSet.selectedTemplate.editMode")?!1:!0},isLettersVisible:function(){let n=this.get("selectedSet");if(n==null)return!1;let t=this.get("selectedSet.selectedTemplate");return t!=null?!1:!n.isNew()},sets:null,selectedSet:null,onSelectedSet:function(n){let t=n.sender.dataItem(n.sender.select());n.data.set("selectedSet",t)},onSelectedSetChange:function(n){n.field=="exceptionPolicies"&&this.updateExceptionPoliciesFilter(this.sets.data())},previewTemplate:function(n){let t=n.data,i=t.placeholders.fetch();i.done(()=>{let n=t.placeholders.data(),i=t.getPreviewText(),r=t.placeholderVisualizer.visualizeText(i,n);this._dialogService.open("previewTemplate",{title:"Preview",viewModel:{letter:r},actions:[{text:"OK",primary:!0,action:()=>!0}]})})},updateExceptionPoliciesFilter:function(n){let t=[];n.forEach(n=>{n.exceptionPolicies.data().forEach(n=>{t.push(n.id)})});n.forEach(n=>{n.updateUnassignedExceptionPoliciesFilter(t)})},updateSet:function(){let n={id:this.selectedSet.id,name:this.selectedSet.editName,isEnabled:this.selectedSet.editIsEnabled,isMailMergeEnabled:this.selectedSet.editIsMailMergeEnabled},t=this._noticeClient.patchNoticeLetterSet(n),i=this;t.done(function(){i.selectedSet.applyChanges()})}})}(window.kendo.jQuery,window.kendo),NoticeAdminView=function(n,t,i){return View.extend({init:function(i,r,u,f){View.fn.init.call(this,i,r);this._webapi=u;this._webapi.error=this.onApiError.bind(this);this._webapi.requestStart=()=>t.ui.progress(n(i),!0);this._webapi.requestEnd=()=>t.ui.progress(n(i),!1);this._dialogService=f;window.kendoEditorPasteCleanup=this.onPasteCleanup},ready:function(t,i){var r=this;let u=i.exceptionPolicies.read();u.done(()=>{let u=i.sets.read();u.done(()=>{View.fn.ready.call(r,t,i),n(".init-hidden").removeClass("init-hidden"),r._ui(t,i),r._events(i),r.ui.setlist.refresh(),r._nav(i)})})},onApiError:function(n){let t=n.response.responseJSON;(t==null||t==i)&&(t={ErrorMessage:n.response.responseText,Errors:[]});t.Status=n.response.status;t.Reason=n.response.statusText;this._dialogService.open("apiErrorDialog",{title:"Oops!",viewModel:t,actions:[{text:"OK"}]})},onfocus:function(n){let t;n.target=="setname"?t=document.getElementById("aa-notice-admin-setname-edit"):n.target=="template.name"?t=document.getElementById("noticelettertemplate-name-edit"):n.target=="top"&&(t=document.body);setTimeout(function(){t.focus();t.scrollIntoView({behavior:"smooth"})})},onPasteCleanup:function(n){const i=new DOMParser,t=i.parseFromString(n,"text/html");let r=t.querySelectorAll(":not(template-placeholder):not(.aa-noticeplaceholder-group):not(.aa-noticeplaceholder-label)");for(let n of r)n.removeAttribute("style"),n.removeAttribute("class");return t.body.innerHTML},onSelectSet:function(t){let i=n("#aa-noticeadmin-setlist").data("kendoListView"),r=i.element.find("[data-uid="+t.item.uid+"]");i.select(r)},ui:{setlist:i},_events:function(n){n.bind("focus",this.onfocus);n.bind("selectset",this.onSelectSet);n.bind("ui.stage",n=>this.ui.stagelist(n))},_nav:function(){const n=new URLSearchParams(window.location.search),t=n.get("letterSet"),i=n.get("templateId");if(t!=null){let u=t.toLowerCase(),r=this.ui.setlist.element.find('[data-id="'+u+'"]'),n=this.ui.setlist.dataItem(r);if(n!=null&&this.ui.setlist.select(r),i!=null){let t=n.templates.data().find(n=>n.id==i.toLowerCase());t!=null&&n.editTemplate({data:t})}}},_ui:function(){this.ui.setlist=n("#aa-noticeadmin-setlist").data("kendoListView");this.ui.templateEditor=()=>n("#templateEditor").data("kendoEditor");this.ui.placeholderTemplate=()=>t.template(n("#noticeplaceholder-template").html());this.ui.stagelist=function(t){let i=n(".noticelettertemplate-stagelist").data("kendoGrid"),r=t.data;i.table.kendoSortable({filter:"> tbody > tr",handler:".noticelettertemplate-stage-draghandle",hint:n.noop,cursor:"move",placeholder:function(n){return n.clone().addClass("k-state-drag")},start:()=>{i.table[0].classList.add("k-state-dragging")},move:function(){console.log("move to index: "+this.indexOf(this.placeholder))},change:function(){let t=i.items(),n=[];for(let r=0;r<t.length;r++){let u=t[r],f=i.dataSource.getByUid(u.getAttribute("data-uid"));n.push({item:f,stage:r+1})}n.forEach(n=>{n.item.set("editStage",n.stage)});r.set("stageEdit",n.some(n=>n.item.stage!=n.item.editStage))},end:function(){i.table[0].classList.remove("k-state-dragging")}})}}})}(window.kendo.jQuery,window.kendo);