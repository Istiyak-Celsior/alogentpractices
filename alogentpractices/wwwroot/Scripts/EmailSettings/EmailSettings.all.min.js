(function(n,t,i){i.mvvm||(i.mvvm={});i.mvvm.Model=i.data.Model.extend({init:function(){i.data.Model.fn.init.call(this)}});i.mvvm.View=i.Class.extend({init:function(n,i){var r=this;r.viewModel=i;t(document).ready(t.proxy(r._ready,r,t(n),i))},_ready:function(n,r){t("[data-role='pageload']").remove();i.ui.progress(n,!0);this.ready(n,r)},ready:function(n,t){i.bind(n,t);i.ui.progress(n,!1)}});i.mvvm.ViewModel=i.data.ObservableObject.extend({init:function(){i.data.ObservableObject.fn.init.call(this,this)}});i.mvvm.DialogViewModel=i.mvvm.ViewModel.extend({init:function(){ViewModel.fn.init.call(this)},triggerClose:function(n,t){this.trigger("close",{userTriggered:n,dialogResult:t})}});i.mvvm.DialogService=i.Class.extend({init:function(n){this.views=n},hasDialogOpen:!1,views:{},open:function(n,r){var o,c;if(!n)throw"Required [view] is missing.";var e=new t.Deferred,s=t("<div class='k-custom-dialog' />").kendoDialog({actions:r.actions,close:function(){this.destroy()}}),f=this.views[n],l=f.id,a=t(l).html(),u=s.data("kendoDialog"),h=t(i.template(a)(r.viewModel));if(u.content(h),f.cssClass){let n=u.element.closest(".k-dialog");t(n).addClass(f.cssClass)}if(f.cssContentClass){let n=s;t(n).addClass(f.cssContentClass)}return u.bind("close",function(n){e.state()!=="resolved"&&e.resolve({userTriggered:n.userTriggered,dialogResult:null})}),r.viewModel&&(i.bind(h,r.viewModel),r.viewModel instanceof i.mvvm.DialogViewModel&&r.viewModel.bind("close",function(n){e.resolve({userTriggered:n.userTriggered,dialogResult:n.dialogResult});u.close()})),r.title&&u.title(r.title),u.open(),this.hasDialogOpen=!0,r.opened&&t.proxy(r.opened(),this),o=e.promise(),c=this,o.always(function(){c.hasDialogOpen=!1}),o}});n.Model=i.mvvm.Model;n.ViewModel=i.mvvm.ViewModel;n.View=i.mvvm.View})(window,window.kendo.jQuery,window.kendo);var ApiService=function(n){function i(i,u){return n.ajax({url:r(u.area,u.controller,u.action),method:i,cache:!1,contentType:"application/json",data:u.data!=undefined?JSON.stringify(u.data):undefined,beforeSend:function(n){typeof u.username!="undefined"&&n.setRequestHeader("x-accuaccount-username",u.username);typeof u.password!="undefined"&&n.setRequestHeader("x-accuaccount-password",u.password);t.requestStart&&t.requestStart.bind(t)()},complete:function(){t.requestEnd&&t.requestEnd.bind(t)()},success:function(n){typeof u.success!="undefined"&&u.success(n);typeof t.success!="undefined"&&t.success()},error:function(n){var i={statusCode:n.status,statusDescription:n.statusText,errorMessage:n.responseJSON!=null?n.responseJSON.ErrorMessage:"A general failure occurred communicating with the server (status: "+n.statusText+").",response:n};typeof u.error!="undefined"&&u.error(i);typeof t.error!="undefined"&&t.error(i)}})}function r(n,t,i){var r="";return n===null?r+="api/":n===""||(r+="api/"),r+=t,i&&(r+="/",r+=i),r}var t={authorizationHeader:undefined,error:undefined,get:undefined,post:undefined,success:undefined,requestStart:undefined,requestEnd:undefined};return t.delete=function(n){return i("DELETE",n)},t.get=function(n){return i("GET",n)},t.patch=function(n){return i("PATCH",n)},t.post=function(n){return i("POST",n)},t.put=function(n){return i("PUT",n)},t},NetworkDeliveryMethod=kendo.data.Model.extend({init:function(n,t){kendo.data.Model.fn.init.call(this);var i=this;i.kind=n;i._service=t;this.set("authenticationType",this.authenticationTypes[1].name)},authenticationType:"",authenticationTypes:[{name:"Windows Authentication"},{name:"Basic Authentication"}],id:0,name:"SMTP AUTH",server:"",port:25,enableSsl:!0,requiresAuthentication:!1,username:"",password:"",hasSendAsPolicy:!1,isBasicAuthenticationType:function(){return this.get("requiresAuthentication")===!0&&this.get("authenticationType")==="Basic Authentication"},onPortChange:function(){this.trigger({field:"port"})}}),PickupFolderDeliveryMethod=kendo.data.Model.extend({init:function(n,t){kendo.data.Model.fn.init.call(this);var i=this;i.kind=n;i._service=t},id:1,name:"Pickup Directory",pickupDirectory:""}),Office365DeliveryMethod=kendo.data.Model.extend({init:function(n,t){kendo.data.Model.fn.init.call(this);var i=this;i.kind=n;i._service=t},id:2,name:"Microsoft 365",tenantId:"",applicationId:"",clientSecret:""}),EmailSettingsViewModel=function(n){return ViewModel.extend({init:function(){ViewModel.fn.init.call(this);this.set("isValid",!1);this.set("deliveryMethod.network",new NetworkDeliveryMethod);this.set("deliveryMethod.pickup",new PickupFolderDeliveryMethod);this.set("deliveryMethod.office365",new Office365DeliveryMethod);this.set("deliveryMethod.items",[this.deliveryMethod.network,this.deliveryMethod.pickup,this.deliveryMethod.office365]);this.set("deliveryMethod.current",this.get("deliveryMethod.items")[0]);this.validation=this._createValidation();this.bind("change",this._onChange)},canSave:function(){var n=this.get("isDirty"),t=this.get("isValid");return n&&t},deliveryMethod:{items:[],current:null},isDirty:!1,serviceMailbox:"",messageSizeLimit:0,enableSecureMail:!1,secureMailPhrase:"",applySettings:function(n){switch(n.DeliveryMethod){case 0:this.set("deliveryMethod.current",this.deliveryMethod.network);break;case 1:this.set("deliveryMethod.current",this.deliveryMethod.pickup);break;case 2:this.set("deliveryMethod.current",this.deliveryMethod.office365)}this.set("messageSizeLimit",n.MaxMessageSize);this.set("secureMailPhrase",n.SecureEmailPhrase);this.set("serviceMailbox",n.ServiceMailbox);this.set("enableSecureMail",n.EnableSecureMail);this.set("deliveryMethod.network.server",n.Server);this.set("deliveryMethod.network.port",n.Port);this.set("deliveryMethod.network.requiresAuthentication",n.RequireAuthentication);this.set("deliveryMethod.network.authenticationType",n.UseDefaultCredentials?"Windows Authentication":"Basic Authentication");this.set("deliveryMethod.network.enableSsl",n.EnableSsl);this.set("deliveryMethod.network.username",n.UserName);this.set("deliveryMethod.network.password",n.Password);this.set("deliveryMethod.network.hasSendAsPolicy",n.HasSendAsPolicy);this.set("deliveryMethod.pickup.pickupDirectory",n.PickupDirectory);this.set("deliveryMethod.office365.tenantId",n.MicrosoftAzureTenantId);this.set("deliveryMethod.office365.clientId",n.MicrosoftAzureClientId);this.set("deliveryMethod.office365.clientSecret",n.MicrosoftAzureClientSecret);this.set("isDirty",!1)},saveSettings:function(){var t=this,i=t._createModel(t);t.trigger("progress",{progress:!0});n.ajax({url:"settings/smtp",method:"PUT",cache:!1,contentType:"application/json",data:JSON.stringify(i),success:function(){t.set("isDirty",!1);t.trigger("progress",{progress:!1})},failure:function(){}})},test:{isAvailable:function(){var n=this.get("fromAddress")!=="",t=this.get("toAddress")!=="",i=this.parent(),r=i.get("isValid");return n&&t&&r},fromAddress:"",toAddress:"",action:function(t){t.preventDefault();var r=this._createModel(this),u=this.test.fromAddress,f=this.test.toAddress,i=this;i.trigger("progress",{progress:!0});n.ajax({url:kendo.format("settings/smtp/verify?fromAddress={0}&toAddress={1}",u,f),method:"POST",cache:!1,contentType:"application/json",data:JSON.stringify(r),success:function(){i.trigger("progress",{progress:!1});i.set("test.state",1);i.set("test.lastError","")},error:function(n){i.trigger("progress",{progress:!1});i.set("test.state",2);i.set("test.lastError",n.responseText)}})},state:0,hasError:function(){return this.get("state")===2},hasSuccess:function(){return this.get("state")===1},lastError:""},_createValidation:function(){var n=this;return{rules:{pickupFolderRule:function(t){return n.deliveryMethod.current instanceof PickupFolderDeliveryMethod&&t[0].name==="pickupFolder"?n.deliveryMethod.pickup.pickupDirectory!=="":!0},networkUserNameRule:function(t){return n.deliveryMethod.current instanceof NetworkDeliveryMethod&&t[0].name==="username"&&n.deliveryMethod.current instanceof NetworkDeliveryMethod&&n.deliveryMethod.network.isBasicAuthenticationType()?n.deliveryMethod.network.username!=="":!0},networkPasswordRule:function(t){return n.deliveryMethod.current instanceof NetworkDeliveryMethod&&t[0].name==="password"&&n.deliveryMethod.current instanceof NetworkDeliveryMethod&&n.deliveryMethod.network.isBasicAuthenticationType()?n.deliveryMethod.network.password!=="":!0},networkPortRule:function(t){return n.deliveryMethod.current instanceof NetworkDeliveryMethod&&t[0].name==="port"?typeof n.deliveryMethod.current.port=="number"&&!isNaN(n.deliveryMethod.current.port):!0}}}},_createModel:function(n){return{EnableSecureMail:n.enableSecureMail,SecureEmailPhrase:n.secureMailPhrase,ServiceMailbox:n.serviceMailbox,DeliveryMethod:n.deliveryMethod.current.id,MaxMessageSize:n.messageSizeLimit,Server:n.deliveryMethod.network.server,Port:n.deliveryMethod.network.port,RequireAuthentication:n.deliveryMethod.network.requiresAuthentication,UseDefaultCredentials:n.deliveryMethod.network.authenticationType==="Windows Authentication",UserName:n.deliveryMethod.network.username,Password:n.deliveryMethod.network.password,EnableSsl:n.deliveryMethod.network.enableSsl,HasSendAsPolicy:n.deliveryMethod.network.hasSendAsPolicy,PickupDirectory:n.deliveryMethod.pickup.pickupDirectory,MicrosoftAzureTenantId:n.deliveryMethod.office365.tenantId,MicrosoftAzureClientId:n.deliveryMethod.office365.clientId,MicrosoftAzureClientSecret:n.deliveryMethod.office365.clientSecret}},_onChange:function(n){n.field!=="isDirty"&&this.set("isDirty",!0)}})}(window.kendo.jQuery),EmailSettingsView=View.extend({init:function(n,t,i){View.fn.init.call(this,n,t);i.error=function(n){console.log(n.errorMessage);console.log(n.response.responseText)};this.webapi=i},ready:function(n,t){this._ui(n);this._events(t);kendo.bind(n,t);this._setDeliveryMethodView(t);var i=this.webapi.get({area:"",controller:"settings",action:"smtp"});i.done(function(i){t.applySettings(i);kendo.ui.progress(n,!1)})},_events:function(){var n=this;n.viewModel.bind("change",$.proxy(n._onViewModelChange,n));n.viewModel.bind("progress",$.proxy(n._onViewModelProgress,n));$("#main-form").on("#network-port","keyup",function(){n.viewModel.deliveryMethod.network.trigger("change",{field:"port"})})},_onViewModelChange:function(n){var t,i;n.field==="deliveryMethod.current"&&this._setDeliveryMethodView(n.sender);n.field!=="isValid"&&(t=this.validator.validate(),this.viewModel.set("isValid",t));(n.field==="test.fromAddress"||n.field==="test.toAddress")&&(i=$("#test-form").data("kendoValidator"),i.validate())},_onViewModelProgress:function(n){var t=$(document.body);window.kendo.ui.progress(t,n.progress)},_setDeliveryMethodView:function(n){var t=n.get("deliveryMethod.current"),i,r;t instanceof NetworkDeliveryMethod&&(i="network-template");t instanceof PickupFolderDeliveryMethod&&(i="pickup-template");t instanceof Office365DeliveryMethod&&(i="office365-template");r=new kendo.View(i,{model:t,evalTemplate:!0,wrap:!1});kendo.destroy($("#mail-configuration"));$("#mail-configuration").empty();r.render($("#mail-configuration"))},_ui:function(){this.validator=$("#main-form").kendoValidator(this.viewModel.validation).data("kendoValidator");$("#test-form").kendoValidator()}});